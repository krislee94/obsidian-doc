#### 创建清单

**构建一个简单的架子** 。

一切的开始都是从一个json文件开始。`manifest.json`开始

```json 

 {  
	"name": "Getting Started Example",  
	"description": "Build an Extension!", 
	"version": "1.0",  
	"manifest_version": 3
 }

```


#### 加载解压的扩展程序


浏览器内输入 `chrome://extensions/` 


![[Pasted image 20220211143939.png]]



#### 现在我们要为这个插件进行充血

**为架子进行充血** 

1. 在清单中注册后台脚本

和许多其他重要组件一样，后台脚本必须在清单中注册，就好像我们使用vue3的时候，需要告诉组件我们需要使用哪些其他组件的一样。

我们需要在在清单中注册一个后台脚本会告诉扩展程序引用哪个文件，以及该文件应该如何运行。

`background` 

```json
{  
 "name":"Getting Started Example",  
 "description":"Build an Extension!",  
 "version":"1.0",  
 "manifest_version":3,  
 "background":{  
        "service_worker":"background.js"  
    }  
}
```

通常在开发的过程中，我们把background作为监听来使用。

2. 创建后台脚本

```js
// background.js

let color = '#3aa757';

chrome.runtime.onInstalled.addListener(() => {
  chrome.storage.sync.set({ color });
  console.log('Default background color set to %cgreen', `color: ${color}`);
});

```


3. 添加存储权限

大多数 API，包括[存储](https://developer.chrome.com/docs/extensions/reference/storage/)API，必须`"permissions"`在清单中的字段下注册，以便扩展使用它们。

```json

{
  "name": "Getting Started Example",
  "description": "Build an Extension!",
  "version": "1.0",
  "manifest_version": 3,
  "background": {
    "service_worker": "background.js"
  },
  "permissions": ["storage"]
}

```


4. 检查后台脚本

![[Pasted image 20220211145630.png]]


5. 引入用户界面

扩展可以有多种形式的[用户界面](https://developer.chrome.com/docs/extensions/mv3/user_interface/)；这将使用一个[弹出窗口](https://developer.chrome.com/docs/extensions/mv3/user_interface#popup)。创建并添加一个名为`popup.html`扩展目录的文件。这个扩展使用一个按钮来改变背景颜色。


```json
{
  "name": "Getting Started Example",
  "description": "Build an Extension!",
  "version": "1.0",
  "manifest_version": 3,
  "background": {
    "service_worker": "background.js"
  },
  "permissions": ["storage"],
  "action": {
    "default_popup": "popup.html"
  }
}

```

放入默认的icon

```json

{
  "name": "Getting Started Example",
  "description": "Build an Extension!",
  "version": "1.0",
  "manifest_version": 3,
  "background": {
    "service_worker": "background.js"
  },
  "permissions": ["storage"],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "16": "/images/get_started16.png",
      "32": "/images/get_started32.png",
      "48": "/images/get_started48.png",
      "128": "/images/get_started128.png"
    }
  }
}

````

6. 给用户的选项

充血完成之后，就是一些自定义标准。打个比方，你一个人后期选择文科还是理科，毕业之后走技术方向还是营销方向等等。

这里同样需要一个html 文件， 我们创建一个options.html并包含一下代码。

```html
<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="button.css">
  </head>
  <body>
    <div id="buttonDiv">
    </div>
    <div>
      <p>Choose a different background color!</p>
    </div>
  </body>
  <script src="options.js"></script>
</html>

```

然后在`manifest.json` 中注册选项页面

```json
{
  "name": "Getting Started Example",
  ...
  "options_page": "options.html"
}

```


最后一步是添加选项逻辑。`options.js`使用以下代码在扩展目录中创建一个名为的文件。

```js
let page = document.getElementById("buttonDiv");
let selectedClassName = "current";
const presetButtonColors = ["#3aa757", "#e8453c", "#f9bb2d", "#4688f1"];

// Reacts to a button click by marking the selected button and saving
// the selection
function handleButtonClick(event) {
  // Remove styling from the previously selected color
  let current = event.target.parentElement.querySelector(
    `.${selectedClassName}`
  );
  if (current && current !== event.target) {
    current.classList.remove(selectedClassName);
  }

  // Mark the button as selected
  let color = event.target.dataset.color;
  event.target.classList.add(selectedClassName);
  chrome.storage.sync.set({ color });
}

// Add a button to the page for each supplied color
function constructOptions(buttonColors) {
  chrome.storage.sync.get("color", (data) => {
    let currentColor = data.color;
    // For each color we were provided…
    for (let buttonColor of buttonColors) {
      // …create a button with that color…
      let button = document.createElement("button");
      button.dataset.color = buttonColor;
      button.style.backgroundColor = buttonColor;

      // …mark the currently selected color…
      if (buttonColor === currentColor) {
        button.classList.add(selectedClassName);
      }

      // …and register a listener for when that button is clicked
      button.addEventListener("click", handleButtonClick);
      page.appendChild(button);
    }
  });
}

// Initialize the page by constructing the color options
constructOptions(presetButtonColors);

```